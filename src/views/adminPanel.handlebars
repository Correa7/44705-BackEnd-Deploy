<br><br>
<div class="container">
    <div>
        <h2>{{message}}</h2>
    </div>
    <br><br>
    <div class="box">
        <div class="box-delIactive">
            <h4>To delete all inactive users <button class="btn" onclick="delInactiveUsers()">click here</button></h4>
        </div>
        {{#if active}}
        <div class="box-active">
            <div><h4 class="title-active">Active Users</h4></div>
            <div class="box-table">
                <table class="table table-striped">
                    <thead class="thead-dark">
                        <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Rol</th>
                        <th scope="col">ID</th>
                        <th scope="col">Delete</th>
                        <th scope="col">Change rol</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each active}}
                        <tr>
                        <td><p>{{this.firstName}} {{this.lastName}}</p></td>
                        <td><p class="table-title-active">{{this.email}}</p></td>
                        <td><p>{{this.rol}}</p></td>
                        <td><p><strong>{{this._id}}</strong></p></td>
                        <td><button class="link" onclick="delUser('{{this._id}}')"><img class="trash-icon" src="/images/icons8-trash-48.png" alt="Trach icon"></button></td>
                        <td><button class="link" onclick="rolUser('{{this._id}}')"><img class="trash-icon" src="/images/icons8-star-64.png" alt="Trach icon"></button></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}
        <br><br>

        {{#if inactive}}
            <div class="box-inactive">
                <div><h4 class="title-inactive">Inactive Users</h4></div>
                <div class="box-table">
                    <table class="table table-striped">
                        <thead class="thead-dark">
                            <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Rol</th>
                            <th scope="col">ID</th>
                            <th scope="col">Delete</th>
                            <th scope="col">Change rol</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each inactive}}
                            <tr>
                            <td><p >{{this.firstName}} {{this.lastName}}</p></td>
                            <td><p class="table-title-inactive">{{this.email}}</p></td>
                            <td><p >{{this.rol}}</p></td>
                            <td><p ><strong>{{this._id}}</strong></p></td>
                            <td><button class="link" onclick="delUser('{{this._id}}')"><img class="trash-icon" src="/images/icons8-trash-48.png" alt="Trach icon"></button></td>
                            <td><button class="link" onclick="rolUser('{{this._id}}')"><img class="trash-icon" src="/images/icons8-star-64.png" alt="Trach icon"></button></td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        {{/if}}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/adminpanel.js"></script>
<script src="src/js/adminpanel.js">
    function warningRol() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'User role change',
            showConfirmButton: false,
            timer: 1000
        })
    }
    function warningDel() {
        Swal.fire({
            position: 'top-end',
            icon: 'error',
            title: 'User Deleted',
            showConfirmButton: false,
            timer: 1000
        })
    }
    function warningDelInactive() {
        Swal.fire({
            position: 'top-end',
            icon: 'error',
            title: 'Successfully deleted users',
            showConfirmButton: false,
            timer: 1000
        })
    }

    async function delUser(id){
        const url =`http://44705-backend-deploy-production.up.railway.app/api/admin/panel/${id}`
        
        const options = {
            method: "DELETE",
            headers:{
                "Content-Type":"application/json",
            }
        }
        fetch(url, options)
        .then((response)=> response.json())
        .then(()=>{
            
            warningDel()
            console.log('User deleted')
            setTimeout(() => {
                location.reload();
            }, 500);
        })
        .catch((error)=>{
            console.error("Error:", error)
        })
    }
    
    async function rolUser(id){
        const url =`http://44705-backend-deploy-production.up.railway.app/api/admin/panel/${id}`
    
        const options = {
            method: "PUT",
            headers:{
                "Content-Type":"application/json",
            } 
        }
        fetch(url, options)
        .then((response)=> response.json())
        .then(()=>{
            warningRol()
            console.log('User change rol')
            setTimeout(() => {
                location.reload();
            }, 500);
        })
        .catch((error)=>{
            console.error("Error:", error)
        })
    }

    async function delInactiveUsers(){
        const url =`http://44705-backend-deploy-production.up.railway.app/api/admin/panel`
        
        const options = {
            method: "DELETE",
            headers:{
                "Content-Type":"application/json",
            }
        }
        fetch(url, options)
        .then((response)=> response.json())
        .then(()=>{
            
            warningDelInactive()
            console.log('User deleted')
            setTimeout(() => {
                location.reload();
            }, 500);
        })
        .catch((error)=>{
            console.error("Error:", error)
        })
    }

</script>
                        
