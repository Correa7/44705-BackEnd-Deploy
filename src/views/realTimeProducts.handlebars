<div class="cont">
    <h2 class="title">Real Time Products</h2>
</div>
    <br><br> 
    <div class="container-forms">
        <div class="forms-box">
            <h5 style="color:rgb(0, 0, 0);">Add Products</h5><hr>
            <form onsubmit="return addProduct() ">
              <div class="form-group row"> 
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="owner" value="{{user.email}}" placeholder="Owner" readonly>
                    </div>
                </div> 
                <div class="form-group row"> 
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="title" placeholder="Title" required>
                    </div>
                </div> 
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="description" placeholder="Description" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="price" placeholder="Price" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="stock" placeholder="Stock" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="code" placeholder="Code" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="category" placeholder="Category" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="thumbnail" placeholder="Thumbnail">
                    </div>
                </div>
                <br>
                <button type="submit"  value="Enviar"  class="btn btn-success">Send</button>
            </form>
        </div>
        <div class="forms-box">
            <h5 style="color:rgb(4, 4, 4);">Delete Products</h5><hr>
            <form onsubmit="return delProduct() ">
                <div class="form-group row">
                    <label for="" class="col-sm-2 col-form-label" style="color:rgb(0, 0, 0);">ID</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="id" placeholder="Id Product..." required>
                    </div>
                </div>
                <br>
                <button type="submit" value="Enviar" class="btn btn-danger">Send</button>
            </form>
        </div>
    </div>

    <div class="contenedor-cards" id="z-cards"> 
        {{#each products}}
                    {{!-- <div class="card" style="width: 15rem;"> --}}
                    <div class="card" >
                    <img src="{{this.thumbnail}}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">{{this.title}}</h5>
                        {{!-- <p class="card-text">Description: {{this.description}}</p> --}}
                        <p class="card-text">Price: $<strong>{{this.price}}</strong> || Stock: {{this.stock}}</p>
                        <br>
                        <p>ID: {{this._id}}</p>
                        <p>Owner: {{this.owner}}</p>
                    </div>
                    {{!-- <div class="card-body">
                    <button id="{{this._id}}" class="btn btn-primary">Add to Cart</button>
                    </div> --}}
                </div>
          {{/each}}  
    </div>




<script src="/socket.io/socket.io.js"></script> 

<script src="/js/realTimeProducts.js"></script> 
<script src="src/js/realTimeProducts.js">
    console.log('Hola soy el cliente')
 
    const socket = io()

    socket.on('wellcome', (data)=>{
        console.log(data)
    })
    socket.on('newData', (data)=>{
        render(data)
    })

    function render(data) {
        const html = data.map(prod=>{
            return (`

            <div class="card" >
            <img src="${prod.thumbnail}" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">${prod.title}</h5>
            
                <p class="card-text">Price: $<strong>${prod.price}</strong> || Stock: ${prod.stock}</p>
                <br>
                <p>ID:</p>
                <p>${prod._id}</p>
            </div>
            <div class="card-body">
            <button id="${prod.id}" class="btn btn-primary">Add to Cart</button>
            </div>
        </div>
            `)
        }).join(' ') 
        document.getElementById('z-cards').innerHTML = html

        setTimeout(() => {
            location.reload();
          }, "1000");
    }
    
    function addProduct(){
        const newProduct={
                title: document.getElementById('title').value,
                description:document.getElementById('description').value,
                price: document.getElementById('price').value,
                thumbnail: document.getElementById('thumbnail').value,
                code:document.getElementById('code').value,
                stock:document.getElementById('stock').value,
                category:document.getElementById('category').value,
                owner:document.getElementById('owner').value,
                status:true,
                    
        }
        cleanForm()
        socket.emit('addProduct', newProduct)   
    return false
    }
    function delProduct(){
        let pId= {
            id:document.getElementById('id').value
        }
        document.getElementById('id').value = ''

        socket.emit('delProduct', pId)
        return false
    }

    function cleanForm(){
        document.getElementById('title').value = ''
        document.getElementById('description').value = ''
        document.getElementById('price').value = ''
        document.getElementById('thumbnail').value = ''
        document.getElementById('code').value = ''
        document.getElementById('stock').value = ''
        document.getElementById('category').value = ''
    }
</script> 